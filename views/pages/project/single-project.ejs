<div id="single-project" class="project" v-cloak>
  <header>
    <div class="title">
      <h2>{{ project.client.title }}</h2>
      <h4>{{ project.title }}</h4>
    </div>
  </header>

  <div class="container">
    <ol class="tasks-list" start="0">
      <li v-for="stage in stages">
        <h2 @click="clickEditStage(stage.id)">{{ stage.title }}</h2>
        <ul>
          <li v-for="task in stage.tasks">
            <div @click="clickEditTask(task.id)" class="task" data-toggle="tooltip" data-placement="bottom" :title="task.status" :data-status="task.status_slug">
              <span class="date">{{ task.due_formatted }}</span>
              <span class="status"></span>
              <a v-on:click.stop v-if="task.url" :href="task.url" target="_blank" class="title">{{ task.title }}</a>
              <span v-else class="title">{{ task.title }}</span>
            </div>
          </li>
        </ul>
      </li>
    </ol>
  </div>

  <% /* Edit Task modal */ %>
  <modal class="mdl" v-if="editTaskModalOpen && selectedTask" v-cloak key="task" @close="closeEditTaskModal()">

    <div class="modal-header">
      <h5 class="modal-title">Edit Task</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span>&times;</span>
      </button>
    </div>

    <ajax-form action="updateTask" :syncing.sync="syncing" :cloud-error.sync="cloudError" :handle-parsing="parseForm" @submitted="submittedForm($event)">
      <div class="modal-body">
        <div class="form-group mt-2">
          <label>Title</label>
          <input class="form-control" type="text" v-model="formData.title" :class="[formErrors.title ? 'is-invalid' : '']">
          <div class="invalid-feedback" v-if="formErrors.title">Please enter a valid title.</div>
        </div>

        <div class="form-group mt-2">
          <label>URL</label>
          <input class="form-control" type="text" v-model="formData.url" :class="[formErrors.url ? 'is-invalid' : '']">
          <div class="invalid-feedback" v-if="formErrors.url">Please enter a valid URL.</div>
        </div>

        <div class="form-group mt-2">
          <label>Due</label>
          <div class="field-wrap mt-2">
            <datepicker ref="datepickerref" v-model="formData.due" placeholder-text="(Choose due date)" :popup="true" :invalid="formErrors.due" validation-error-message="Error message?"></datepicker>
          </div>
        </div>

        <div class="form-group mt-2">
          <label>Status</label>
          <div class="field-wrap mt-2">
            <select v-model="formData.status">
              <option value="In Progress">In Progress</option>
              <option value="Approved">Approved</option>
              <option value="Ready for Review">Ready for Review</option>
            </select>
          </div>
        </div>

        <p class="text-danger" v-if="cloudError"><small>An error occured while processing the form.</small></p>
      </div>
      <div class="modal-footer  flex-row-reverse justify-content-start">
        <ajax-button type="submit" :syncing="syncing" class="btn btn-primary ml-1">Save</ajax-button>
        <button data-dismiss="modal" class="btn btn-outline-primary mr-1">Cancel</button>
      </div>
    </ajax-form>
    <!--
    <div class="modal-body" v-else>
      <p>foo</p>
    </div>
    -->
  </modal>

</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
